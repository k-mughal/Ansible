# Fact Variables: setup module
- During the execution of Ansible, it performs the 'TASK Gathering Facts,' as highlighted in the snippet below. In this context, we will specifically focus on this task. The setup module collects information about the host in JSON format only during runtime. It doesn't actively utilize this information unless we explicitly want to use the variables generated by the setup module. 

```
cd exercise9
ansible-playbook vars-precedence-playbook.yaml
```
 <p align="center">
  <img src="https://github.com/k-mughal/Ansible/assets/18217530/cf5d030f-956d-418d-aa6f-3842f5dad1d2">
</p>

- If not needed, this functionality can be disabled. To do so, you can set 'gather_facts: false' just before the task in your playbook. Upon running the playbook with this configuration, you will observe that the 'Gathering Facts' task is no longer present.
  
 <p align="center">
  <img src="https://github.com/k-mughal/Ansible/assets/18217530/75de291c-1588-48fd-8953-4bae302391f6">
</p>

- We can run this task using an ad-hoc command, generating extensive information in JSON format.The entire output is essentially a dictionary, a substantial one, where keys correspond to Ansible facts. Each key holds another dictionary with its own set of keys. Some key-value pairs are in list format, denoted by square brackets, while others are structured as another dictionary, indicated by curly braces. This results in a multitude of variables. Below, we will run the 'setup' module to collect facts from the web01 server.

```
cd exercise9
ansible -m setup web01
```
<p align="center">
  <img src="https://github.com/k-mughal/Ansible/assets/18217530/0421b165-e1fe-4f9a-9590-df36a80b97c4">
</p>

- we can display the JSON information using the fact variables for instance "ansible_distribution"
  
```
vim print-facts.yaml
- name: Print facts
  host: all
  tasks:
    - name: Print OS name
      debug:
        var: ansible_distribution
:wq

ansible-playbook print-facts.yaml
```
<p align="center">
  <img src="https://github.com/k-mughal/Ansible/assets/18217530/fda0f42f-d96a-47cd-88a3-20f5551b939b">
</p>

  
  - For next exercise we will setup one more EC2 instance with Ubuntu.
  - **Step 1 :** Create an EC2 instance and refer to it as the host machine.
    - Launch instance: **Name :** web03, **Image :** Ubuntu Server 22.04, **Instance type :** t2.micro, **Key pair :** client-key(same key), **Network settings->Edit->Select existing security group :** client-sg (same group), Launch instance.
  - Copy the private IP address of web03 and update the inventory as shown below

```
cd exercise9
vim inventory
```
<p align="center">
  <img src="https://github.com/k-mughal/Ansible/assets/18217530/0d9a1b64-8805-4f60-91c4-a4939d8d471d">
</p>

- If we test the connection with -m ping module we encounter an error as we have defined global variables but as we know host variable take higher precedence in such cases we can define separate ansible user variable  for web03.
  
  <p align="center">
  <img src="https://github.com/k-mughal/Ansible/assets/18217530/ef57ca00-bd9f-46a5-b761-003f92792f0c">
</p>

- Modify the inventory file by adding separate ansible user(ubuntu) variable.
  
```
cd exercise9
vim inventory
```

<p align="center">
  <img src="https://github.com/k-mughal/Ansible/assets/18217530/6e0c82a1-61f6-4447-96eb-c0ac3c156f6a">
</p>

- If you rerun the 'print-facts' playbook, you will observe that the Ansible distribution value is now displayed for web03.

```
ansible-playbook print-facts.yaml
```
<p align="center">
  <img src="https://github.com/k-mughal/Ansible/assets/18217530/51fd1a12-9e35-4bee-9981-a73485d0323d">
</p>

- Lets execute the setup module manually and use few other variables

```
ansible -m setup web01
```

<p align="center">
  <img src="https://github.com/k-mughal/Ansible/assets/18217530/06acb367-0c93-4729-af93-6834a0310d62">
</p>

```
vim print-facts.yaml

- name: Print facts
  hosts: all
  tasks:
    - name: Print OS name
      debug:
        var: ansible_distribution
      debug:
        var: ansible_memory_mb.real.free
    - name: Print Processor name
      debug:
        var: ansible_processor[2]

:wq

ansible-playbook print-facts.yaml

```
<p align="center">
  <img src="https://github.com/k-mughal/Ansible/assets/18217530/599317e8-ba14-4267-80b7-c69a33729369">
</p>





